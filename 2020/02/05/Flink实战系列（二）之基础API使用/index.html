<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  
  
    <meta name="keywords" content="bigdata">
  
  
    <meta name="description" content="Javaã€å¤§æ•°æ®ç›¸å…³ä»¥åŠéšæƒ³æ„Ÿæ‚Ÿ">
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>
    Flinkå®æˆ˜ç³»åˆ—ï¼ˆäºŒï¼‰ä¹‹åŸºç¡€APIä½¿ç”¨ |
    
    è¶£éšè®°</title>
  
    <link rel="shortcut icon" href="/favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<script src="/js/pace.min.js"></script>

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
<main class="content">
  <section class="outer">
  <article id="post-Flinkå®æˆ˜ç³»åˆ—ï¼ˆäºŒï¼‰ä¹‹åŸºç¡€APIä½¿ç”¨" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

    <div class="article-inner">
        
            <header class="article-header">
                
  
    <h1 class="article-title" itemprop="name">
      Flinkå®æˆ˜ç³»åˆ—ï¼ˆäºŒï¼‰ä¹‹åŸºç¡€APIä½¿ç”¨
    </h1>
  
  




            </header>
            

                
                    <div class="article-meta">
                        <a href="/2020/02/05/Flink%E5%AE%9E%E6%88%98%E7%B3%BB%E5%88%97%EF%BC%88%E4%BA%8C%EF%BC%89%E4%B9%8B%E5%9F%BA%E7%A1%80API%E4%BD%BF%E7%94%A8/" class="article-date">
  <time datetime="2020-02-05T02:17:35.000Z" itemprop="datePublished">2020-02-05</time>
</a>
                            
  <div class="article-category">
    <a class="article-category-link" href="/categories/Flink/">Flink</a>
  </div>

                    </div>
                    

                        
                            
    <div class="tocbot"></div>





                                

                                    <div class="article-entry" itemprop="articleBody">
                                        


                                            

                                                
                                                                    <p>æ‘˜è¦ï¼šFlinkä¸­å®šä¹‰ä¸¤ä¸ªç‰¹æ®Šç±»æ¥ä»£è¡¨æ•°æ®ï¼šDataSetã€DataStreamï¼Œ<strong>ä¸¤è€…ä¸Javaä¸­çš„é›†åˆä¸åŒï¼Œå®ƒä»¬æ˜¯ä¸å¯å˜çš„ï¼Œä¹Ÿå°±æ˜¯ä¸€æ—¦è¢«åˆ›å»ºå…¶ä¸­çš„æ•°æ®ä¸èƒ½è¢«å¢æ·»æˆ–è€…åˆ é™¤ï¼ŒåŒæ—¶å®ƒä»¬å…è®¸æ•°æ®å¯é‡å¤ã€‚</strong>å¦‚æœä½ ä½¿ç”¨å¦‚mapã€filterç­‰ç®—å­ï¼Œé‚£ä¹ˆæ–°çš„DataSet/DataStreamå°±åœ¨æ¯ä½¿ç”¨transformationsç®—å­ä¹‹åå°±ä¼šè¢«åˆ›å»ºã€‚</p>
<a id="more"></a>
<h1 id="DataSet-DataStream"><a href="#DataSet-DataStream" class="headerlink" title="DataSet/DataStream"></a>DataSet/DataStream</h1><h1 id="ç¨‹åºæµç¨‹"><a href="#ç¨‹åºæµç¨‹" class="headerlink" title="ç¨‹åºæµç¨‹"></a>ç¨‹åºæµç¨‹</h1><p>Flinkçš„ç¨‹åºç¼–å†™æä¸ºè§„å¾‹ï¼Œæ¯ä¸ªç¨‹åºéƒ½åŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼Œè¿™é‡Œä»¥WordCountä¸¾ä¾‹ï¼Œç¤ºä¾‹æ•°æ®å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hadoop,hadoop,hadoop</span><br><span class="line">flink,flink</span><br><span class="line">spark</span><br></pre></td></tr></table></figure>

<p><a name="AHFjM"></a></p>
<h2 id="è·å–Execution-Environment"><a href="#è·å–Execution-Environment" class="headerlink" title="è·å–Execution Environment"></a>è·å–Execution Environment</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æµå¤„ç†</span></span><br><span class="line"><span class="keyword">val</span> env = <span class="type">StreamExecutionEnvironment</span>.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰¹å¤„ç†</span></span><br><span class="line"><span class="keyword">val</span> env = <span class="type">ExecutionEnvironment</span>.getExecutionEnvironment</span><br></pre></td></tr></table></figure>
<p>è™½ç„¶å®˜æ–¹æä¾›ä»¥ä¸‹ä¸‰ç±»è·å–Environmentï¼Œä½†æ˜¯é€šå¸¸åªéœ€è¦ä½¿ç”¨getExecutionEnvironment()ï¼Œå®ƒä¼šæ ¹æ®ç¯å¢ƒæ¥æ­£ç¡®åœ°çš„åˆ›å»ºEnvironmentï¼Œå¦‚æœç¨‹åºæ‰§è¡Œåœ¨IDEç¼–è¾‘å™¨æˆ–è€…ä½œä¸ºå¸¸è§„çš„Javaç¨‹åºæ‰§è¡Œï¼Œå®ƒå°±ä¼šåœ¨ä½ æœºå™¨ä¸Šåˆ›å»ºä¸€ä¸ªæœ¬åœ°çš„Environmentï¼›å¦‚æœä½¿ç”¨å‘½ä»¤è¡Œæ–¹å¼è°ƒç”¨JaråŒ…ï¼ŒFlink cluster managerå°±ä¼šæ‰§è¡Œå¯¹åº”çš„mainæ–¹æ³•åŒæ—¶getExecutionEnvironment()å°±ä¼šè¿”å›ç”¨äºé›†ç¾¤ç¯å¢ƒçš„Environmentã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">getExecutionEnvironment()</span><br><span class="line"></span><br><span class="line">createLocalEnvironment()</span><br><span class="line"></span><br><span class="line">createRemoteEnvironment(host: String, port: Int, jarFiles: String*)</span><br></pre></td></tr></table></figure>

<p><a name="16L44"></a></p>
<h2 id="åŠ è½½-åˆ›å»ºæ•°æ®-Source"><a href="#åŠ è½½-åˆ›å»ºæ•°æ®-Source" class="headerlink" title="åŠ è½½/åˆ›å»ºæ•°æ®(Source)"></a>åŠ è½½/åˆ›å»ºæ•°æ®(Source)</h2><p>å¦‚æœä½ æƒ³è¯»å–æ–‡ä»¶æ•°æ®å¯ä»¥ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> ds = env.readTextFile(<span class="string">"input/wc.txt"</span>)</span><br></pre></td></tr></table></figure>

<p><a name="mJfxi"></a></p>
<h2 id="æŒ‡å®šTransformationsç®—å­"><a href="#æŒ‡å®šTransformationsç®—å­" class="headerlink" title="æŒ‡å®šTransformationsç®—å­"></a>æŒ‡å®šTransformationsç®—å­</h2><p>æ¯ä¸ªtransformationç®—å­éƒ½ä¼šäº§ç”Ÿæ–°çš„DataSet/DataStreamï¼Œä»¥ä¸‹å°±æ˜¯WordCountç»Ÿè®¡æ‰€ç”¨åˆ°ç®—å­ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//wordcountç»Ÿè®¡</span></span><br><span class="line"><span class="keyword">val</span> result = ds.flatMap(_.split(<span class="string">","</span>))</span><br><span class="line">      .map((_, <span class="number">1</span>))</span><br><span class="line">      .keyBy(<span class="number">0</span>)</span><br><span class="line">      .sum(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p><a name="opHtQ"></a></p>
<h2 id="æŒ‡å®šè®¡ç®—ä¹‹åç»“æœè¾“å‡ºåˆ°å“ªé‡Œ-Sink"><a href="#æŒ‡å®šè®¡ç®—ä¹‹åç»“æœè¾“å‡ºåˆ°å“ªé‡Œ-Sink" class="headerlink" title="æŒ‡å®šè®¡ç®—ä¹‹åç»“æœè¾“å‡ºåˆ°å“ªé‡Œ(Sink)"></a>æŒ‡å®šè®¡ç®—ä¹‹åç»“æœè¾“å‡ºåˆ°å“ªé‡Œ(Sink)</h2><p>print()æ–¹æ³•æ˜¯è®©ç»“æœæ‰“å°åœ¨æ§åˆ¶å°ä»¥ä¾¿è§‚å¯Ÿï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨writeAsText(path: String)æ¥å†™å…¥æ–‡ä»¶ä¸­ã€‚</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">result.print()</span><br></pre></td></tr></table></figure>

<p><a name="RQUGH"></a></p>
<h2 id="è§¦å‘"><a href="#è§¦å‘" class="headerlink" title="è§¦å‘"></a>è§¦å‘</h2><p>è¿™é‡Œéœ€è¦æé†’çš„æ˜¯ï¼Œåªæœ‰æµå¤„ç†éœ€è¦æ˜¾å¼è§¦å‘ï¼Œè€Œæ‰¹å¤„ç†åªéœ€è¦æŒ‡å®šè¾“å‡ºå³å¯ã€‚</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">env.execute(<span class="keyword">this</span>.getClass.getSimpleName)</span><br></pre></td></tr></table></figure>

<p><strong>âš ï¸æ³¨æ„ï¼šä»¥ä¸Šæ“ä½œä¸ä¼šåƒJavaç¨‹åºä¸€æ ·åœ¨mainæ–¹æ³•è¢«å¯åŠ¨ä¹‹åç«‹åˆ»æ‰§è¡Œç›¸å…³æ“ä½œï¼Œè€Œæ˜¯å°†æ¯ä¸ªæ“ä½œæ·»åŠ åœ¨Flinkç»´æŠ¤çš„æœ‰å‘æ— ç¯å›¾(ç®€ç§°DAG)ä¸­ï¼Œåªæœ‰å½“è¢«è§¦å‘ä¹‹åæ•´ä¸ªDAGæ‰å¼€å§‹æ‰§è¡Œï¼Œè¿™ä¹Ÿå°±æ˜¯Lazy Evaluation(æ‡’åŠ è½½)ã€‚</strong><br />**<br><a name="MLyGe"></a></p>
<h1 id="å¹¶è¡Œåº¦Parallel"><a href="#å¹¶è¡Œåº¦Parallel" class="headerlink" title="å¹¶è¡Œåº¦Parallel"></a>å¹¶è¡Œåº¦Parallel</h1><p><a name="VZQQa"></a></p>
<h2 id="æå‡ºé—®é¢˜"><a href="#æå‡ºé—®é¢˜" class="headerlink" title="æå‡ºé—®é¢˜"></a>æå‡ºé—®é¢˜</h2><p>å¦‚æœä½ æŒ‰ç…§ä¸Šè¿°WordCountä¾‹å­è¿è¡Œçš„è¯ï¼Œä½ åº”è¯¥èƒ½çœ‹åˆ°ä»¥ä¸‹è¾“å‡ºå†…å®¹ã€‚å¾ˆæ˜æ˜¾ä¸Sparkçš„ä¸å¤ªä¸€æ ·ï¼Œä¸ºä»€ä¹ˆä¼šå‡ºç°(flink,1)ã€(hadoop,1)ç­‰è¾“å‡ºå†…å®¹å‘¢ï¼ŸåŸå› æ˜¯Flinkå¯¹æ¯”Sparkæ¥è¯´ï¼Œæ•°æ®ä¸ä¼šä»¥æ‰¹æ¬¡å¤„ç†ï¼Œè€Œæ˜¯çœŸæ­£çš„å®æ—¶å¤„ç†ï¼Œå½“ç¬¬ä¸€ä¸ªhadoopè¢«åŠ è½½ç«‹å³è¾“å‡º(hadoop,1)ï¼Œç­‰åˆ°ç¬¬äºŒä¸ªhadoopåˆ°è¾¾æ—¶å°±å˜æˆ(hadoop,2)ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">11&gt; (hadoop,1)</span><br><span class="line">11&gt; (hadoop,2)</span><br><span class="line">11&gt; (hadoop,3)</span><br><span class="line">1&gt; (spark,1)</span><br><span class="line">10&gt; (flink,1)</span><br><span class="line">10&gt; (flink,2)</span><br></pre></td></tr></table></figure>

<p>ä¸çŸ¥é“ä½ æ˜¯å¦æ³¨æ„åˆ°ç»“æœä¹‹å‰çš„æ•°å­—ï¼Œæ¯”å¦‚11ã€1ã€10ï¼Œè¿™äº›ä»£è¡¨ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆhadoopå‰é¢ä¼šæ˜¯11ï¼Œsparkå‰é¢æ˜¯1ï¼Œflinkå‰é¢æ˜¯10ï¼Ÿè¦ææ¸…æ¥šè¿™äº›é—®é¢˜å°±å¿…é¡»å…ˆäº†è§£Flinkä¸­çš„å¹¶è¡Œåº¦ã€‚</p>
<p><a name="Hik24"></a></p>
<h2 id="ä»€ä¹ˆæ˜¯å¹¶è¡Œåº¦"><a href="#ä»€ä¹ˆæ˜¯å¹¶è¡Œåº¦" class="headerlink" title="ä»€ä¹ˆæ˜¯å¹¶è¡Œåº¦"></a>ä»€ä¹ˆæ˜¯å¹¶è¡Œåº¦</h2><p>å‰ä¸€ç¯‡ä»‹ç»äº†Flinkæ˜¯åˆ†å¸ƒå¼ä¸”ä»»åŠ¡å¹¶è¡Œæ‰§è¡Œçš„è®¡ç®—å¼•æ“ï¼Œåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ•°æ®æµä¼šæœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªåˆ†åŒºï¼Œæ¯ä¸ªæ“ä½œTaskä¹Ÿä¼šæœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªå­æ“ä½œTaskï¼Œ<strong>è¿™é‡Œçš„å¹¶è¡Œåº¦ä¹Ÿå°±æ˜¯æŒ‡å®šçš„æ“ä½œæœ‰å¤šå°‘ä¸ªå­æ“ä½œTaskï¼ŒåŒä¸€ä¸ªä»£ç ä¸­æ¯ä¸ªæ“ä½œçš„å¹¶è¡Œåº¦éƒ½ä¸ä¸€å®šç›¸åŒã€‚</strong><br /><img src="/images/parallel_dataflow.svg" alt="parallel_dataflow.svg"><br />Flinkä¸­æœ‰ä¸¤ç±»æ“ä½œï¼šone-to-oneå’Œredistributingéƒ½ä¸å¹¶è¡Œåº¦æœ‰å…³ï¼š</p>
<ul>
<li>One-to-one</li>
</ul>
<p>ä¾‹å¦‚Sourceä¸map()ä¹‹é—´ï¼Œä¿ç•™æ•°æ®çš„é¡ºåºå’Œåˆ†åŒºï¼Œç±»ä¼¼ä¸Sparkçš„çª„ä¾èµ–ã€‚</p>
<ul>
<li>Redistributing</li>
</ul>
<p>ä¾‹å¦‚map()å’ŒkeyBy/windowã€keyBy/windowå’ŒSinkä¹‹é—´æ•°æ®é‡æ–°åˆ†é…åˆ°ä¸åŒå­Taskä¸Šã€‚ä¸åŒç®—å­ä¼šæœ‰ä¸åŒåˆ†é…æ–¹å¼ï¼škeyBy() é€šè¿‡Keyå€¼æ¥Hashè¿›è¡Œé‡æ–°åˆ†é…ã€broadcast()å’Œrebalance()åˆ™æ˜¯éšæœºåˆ†é…ã€‚</p>
<p><a name="nQJwe"></a></p>
<h2 id="å›ç­”é—®é¢˜"><a href="#å›ç­”é—®é¢˜" class="headerlink" title="å›ç­”é—®é¢˜"></a>å›ç­”é—®é¢˜</h2><p>å›åˆ°ä¹‹å‰çš„é—®é¢˜ï¼Œè¾“å‡ºç»“æœä¹‹å‰çš„æ•°å­—å…¶å®å°±æ˜¯çº¿ç¨‹å·ï¼Œç»è¿‡keyBy()é‡æ–°åˆ†é…ä¹‹ååŒä¸€keyéƒ½åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å¤„ç†ã€‚å¦‚æœä¸æƒ³çœ‹åˆ°è¿™äº›çº¿ç¨‹å·ï¼Œåªéœ€è¦åœ¨print()åé¢åŠ ä¸ŠsetParallelism(1)å°±è¡Œã€‚å…¶å®æœ‰å¾ˆå¤šä¸­è®¾ç½®å¹¶è¡Œåº¦æ–¹æ³•ï¼Œä¹‹åç³»åˆ—æ–‡ç« ä¼šè¯¦ç»†å†™ä¸€éƒ¨åˆ†ã€‚</p>
<p><a name="n2onG"></a></p>
<h1 id="å¤šç§æŒ‡å®šKeyçš„æ–¹å¼"><a href="#å¤šç§æŒ‡å®šKeyçš„æ–¹å¼" class="headerlink" title="å¤šç§æŒ‡å®šKeyçš„æ–¹å¼"></a>å¤šç§æŒ‡å®šKeyçš„æ–¹å¼</h1><p>ä¸€äº›transformationsç®—å­ï¼Œä¾‹å¦‚ï¼šjoin, coGroup, keyBy, groupByéœ€è¦ä½¿ç”¨è€…æŒ‡å®šKeyï¼Œä»¥ä¾¿ä¹‹åçš„Reduce, GroupReduce, Aggregate, Windowsç­‰ç®—å­è®¡ç®—ã€‚<br><a name="1zv32"></a></p>
<h2 id="TuplesæŒ‡å®šKey"><a href="#TuplesæŒ‡å®šKey" class="headerlink" title="TuplesæŒ‡å®šKey"></a>TuplesæŒ‡å®šKey</h2><p>ä¸Šæ–¹WCä¾‹å­å°±æ˜¯åœ¨Tupleä¸­é€šè¿‡indexæ¥æŒ‡å®šKeyçš„ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> result = ds.flatMap(_.split(<span class="string">","</span>))</span><br><span class="line">      .map((_, <span class="number">1</span>))</span><br><span class="line">      .keyBy(<span class="number">0</span>)</span><br><span class="line">      .sum(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>âš ï¸éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½ æœ‰ä¸ªå¦‚ä¸‹æ‰€ç¤ºçš„DataStreamï¼Œkey(0)åˆ™æ˜¯æŒ‡çš„å…¶ä¸­çš„Tuple2&lt;Integer,Float&gt;ï¼Œå¦‚æœä½ æƒ³æŒ‡å®šTuple2ä¸­çš„Integerï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼äº<em>.</em>1._1ã€‚</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DataStream</span>&lt;<span class="type">Tuple3</span>&lt;<span class="type">Tuple2</span>&lt;<span class="type">Integer</span>, <span class="type">Float</span>&gt;,<span class="type">String</span>,<span class="type">Long</span>&gt;&gt; ds;</span><br></pre></td></tr></table></figure>

<p><a name="7CsiD"></a></p>
<h2 id="å­—æ®µæŒ‡å®šKey"><a href="#å­—æ®µæŒ‡å®šKey" class="headerlink" title="å­—æ®µæŒ‡å®šKey"></a>å­—æ®µæŒ‡å®šKey</h2><p>è¿™ä¸ªæ˜¯åŸºäºå­—æ®µåæ¥æŒ‡å®šKeyï¼Œç‰¹åˆ«é€‚åˆåµŒå¥—ç±»å‹ï¼Œä¾‹å¦‚Tupleå’ŒPOJOã€‚é¦–å…ˆå¾—å®šä¹‰ä¸€ä¸ªWC POJOæ¥æ¥å—æ•°æ®ï¼Œå»ºè®®ä½¿ç”¨case classï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">WC</span>(<span class="params">word:<span class="type">String</span>,count:<span class="type">Int</span></span>)</span></span><br><span class="line"><span class="class"><span class="title">input</span>.<span class="title">flatMap</span>(<span class="params">_.split(","</span>))</span></span><br><span class="line"><span class="class">      .<span class="title">map</span>(<span class="params">ele =&gt; &#123;</span></span></span><br><span class="line"><span class="class"><span class="params">        <span class="type">WC</span>(ele, 1</span>)</span></span><br><span class="line"><span class="class">      &#125;)</span></span><br><span class="line"><span class="class">      .<span class="title">keyBy</span>(<span class="params">"word"</span>)</span></span><br><span class="line"><span class="class">      .<span class="title">sum</span>(<span class="params">"count"</span>)</span></span><br></pre></td></tr></table></figure>

<p><a name="lLVu7"></a></p>
<h2 id="Key-Selectoræ–¹æ³•æŒ‡å®šKey"><a href="#Key-Selectoræ–¹æ³•æŒ‡å®šKey" class="headerlink" title="Key Selectoræ–¹æ³•æŒ‡å®šKey"></a>Key Selectoræ–¹æ³•æŒ‡å®šKey</h2><p>Key Selectoræ–¹æ³•é€šè¿‡ä½¿ç”¨è€…å°†æ•°æ®ä½œä¸ºè¾“å…¥ï¼Œå¹¶è¿”å›æ‰€æƒ³è¦çš„Keyï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">input.flatMap(_.split(<span class="string">","</span>))</span><br><span class="line">      .map(x =&gt; &#123;</span><br><span class="line">        <span class="type">WC</span>(x, <span class="number">1</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">      .keyBy(_.word)</span><br><span class="line">      .sum(<span class="string">"count"</span>)</span><br></pre></td></tr></table></figure>
<p><a name="C7iTK"></a></p>
<h2 id="Flinkæ”¯æŒçš„æ•°æ®ç±»å‹"><a href="#Flinkæ”¯æŒçš„æ•°æ®ç±»å‹" class="headerlink" title="Flinkæ”¯æŒçš„æ•°æ®ç±»å‹"></a>Flinkæ”¯æŒçš„æ•°æ®ç±»å‹</h2><ul>
<li>Java Tuples and Scala Case Classes</li>
<li>Java POJOs</li>
</ul>
<p>_    1. ç±»å¿…é¡»ä¸ºpublic_<br />_    2. å¿…é¡»å«æœ‰æ— å‚æ„é€ å‡½æ•°_<br />_    3. æœ‰æ‰€æœ‰å±æ€§çš„get/setæ–¹æ³•_<br />_    4. æ”¯æŒåºåˆ—åŒ–_</p>
<ul>
<li>Primitive Typesï¼šFlinkæ”¯æŒæ‰€æœ‰Javaå’ŒScalaåŸç”Ÿç±»å‹ï¼Œä¾‹å¦‚ï¼šIntegerï¼ŒStringå’ŒDouble</li>
<li>Regular Classesï¼šæ”¯æŒå¤§éƒ¨åˆ†Javaå’ŒScalaçš„APIå’Œç±»ï¼Œé™¤å¼€æ— æ³•åºåˆ—åŒ–çš„ï¼Œä¾‹å¦‚IOæµã€æ–‡ä»¶æŒ‡é’ˆç­‰</li>
<li>Valuesï¼šæ‰‹åŠ¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œé€šè¿‡å®ç°org.apache.flinktypes.Valueæ¥å£ä¸­çš„readå’Œwriteæ–¹æ³•</li>
<li>Hadoop Writablesï¼šå®ç°org.apache.hadoop.Writableæ¥å£çš„ç±»å‹</li>
<li>Special Typesï¼šScalaçš„Eitherï¼ŒOptionå’ŒTry</li>
</ul>
<p><a name="YFIGd"></a></p>
<h1 id="å¤šç§å®ç°Transformationæ–¹æ³•"><a href="#å¤šç§å®ç°Transformationæ–¹æ³•" class="headerlink" title="å¤šç§å®ç°Transformationæ–¹æ³•"></a>å¤šç§å®ç°Transformationæ–¹æ³•</h1><p><a name="bkzBS"></a></p>
<h2 id="Lambda-Functions"><a href="#Lambda-Functions" class="headerlink" title="Lambda Functions"></a>Lambda Functions</h2><p>å°±åƒå‰é¢çš„ä¾‹å­ä¸€æ ·ï¼Œä½¿ç”¨Lambdaè¡¨è¾¾å¼æ¥å®ç°è‡ªå·±çš„Transformationæ–¹æ³•ã€‚</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">env.readTextFile(<span class="string">"input/access.log"</span>)</span><br><span class="line">        .map(x =&gt; &#123;</span><br><span class="line">          <span class="keyword">val</span> splits = x.split(<span class="string">","</span>)</span><br><span class="line">          (splits(<span class="number">0</span>).toLong,splits(<span class="number">1</span>),splits(<span class="number">2</span>).toInt)</span><br><span class="line">        &#125;)</span><br><span class="line">        .filter(_._3 &gt; <span class="number">5000</span>)</span><br><span class="line">        .print()</span><br></pre></td></tr></table></figure>

<p><a name="m5wiI"></a></p>
<h2 id="Rich-Functions"><a href="#Rich-Functions" class="headerlink" title="Rich Functions"></a>Rich Functions</h2><p>æ‰€æœ‰çš„Transformationæ–¹æ³•éƒ½æœ‰å¯¹åº”çš„Richæ–¹æ³•ï¼Œä¾‹å¦‚mapå°±å¯¹åº”RichMapFunctionã€‚Rich Functionä¸ä»…è®©ä½¿ç”¨è€…è‡ªå·±å®ç°ç›¸å…³æ–¹æ³•(ä¾‹å¦‚mapã€filterç­‰)ï¼Œè¿˜æä¾›ç”Ÿå‘½å‘¨æœŸæ–¹æ³•(ä¾‹å¦‚openã€close)ä»¥åŠRunTimeContextç”¨æ¥ä¼ é€’å‚æ•°ã€å¹¿æ’­å˜é‡ç­‰ã€‚</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¸¤ç§æ–¹å¼ï¼šåŒ¿åå†…éƒ¨ç±»ä»¥åŠåˆ›å»ºç»§æ‰¿ç›¸å…³Richçš„æ–°ç±»</span></span><br><span class="line"><span class="comment">//æ³¨æ„mapå’Œfilter</span></span><br><span class="line">env.readTextFile(<span class="string">"input/access.log"</span>)</span><br><span class="line">        .map(<span class="keyword">new</span> <span class="type">RichMapFunction</span>[<span class="type">String</span>,<span class="type">Access</span>] &#123;</span><br><span class="line">          <span class="comment">//setup methods</span></span><br><span class="line">          <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">open</span></span>(parameters: <span class="type">Configuration</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">            println(<span class="string">"~~~~~~~~~open~~~~~~~~~~~~"</span>)</span><br><span class="line">            <span class="keyword">super</span>.open(parameters)</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">map</span></span>(input: <span class="type">String</span>): <span class="type">Access</span> = &#123;</span><br><span class="line">            <span class="keyword">val</span> splits = input.split(<span class="string">","</span>)</span><br><span class="line">            <span class="type">Access</span>(splits(<span class="number">0</span>),splits(<span class="number">1</span>),splits(<span class="number">2</span>).toInt)</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment">//teardown methods</span></span><br><span class="line">          <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">close</span></span>(): <span class="type">Unit</span> = <span class="keyword">super</span>.close()</span><br><span class="line">        &#125;)</span><br><span class="line">      .filter(<span class="keyword">new</span> <span class="type">MyFilterFun</span>)</span><br><span class="line">      .print().setParallelism(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyFilterFun</span> <span class="keyword">extends</span> <span class="title">RichFilterFunction</span>[<span class="type">Access</span>]</span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">filter</span></span>(input: <span class="type">Access</span>): <span class="type">Boolean</span> = &#123;</span><br><span class="line">      input.flow &gt; <span class="number">5000</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p><a name="LQWJK"></a></p>
<h1 id="ç´¯åŠ å™¨"><a href="#ç´¯åŠ å™¨" class="headerlink" title="ç´¯åŠ å™¨"></a>ç´¯åŠ å™¨</h1><p>Flinkå†…ç½®ä¸¤ç±»ç´¯åŠ å™¨ï¼Œè¿™äº›éƒ½æ˜¯å®ç°Accumulatoræ¥å£ï¼š</p>
<ul>
<li>IntCounterã€LongCounterã€DoubleCounterç­‰</li>
<li>Histogramï¼šç¦»æ•£ç›´æ–¹å›¾å®ç°ï¼Œå†…éƒ¨å®ç°ä¸ºIntegeråˆ°Integerçš„æ˜ å°„ï¼Œç”¨äºç›‘æ§ã€‚<br><a name="bnFpR"></a><h2 id="å¦‚ä½•ä½¿ç”¨"><a href="#å¦‚ä½•ä½¿ç”¨" class="headerlink" title="å¦‚ä½•ä½¿ç”¨"></a>å¦‚ä½•ä½¿ç”¨</h2>ç¬¬ä¸€æ­¥ï¼Œåœ¨ä½ è‡ªå·±å®ç°çš„transformationæ–¹æ³•ä¸­åˆ›å»ºä¸€ä¸ªç´¯åŠ å™¨å¯¹è±¡ï¼›<br />ç¬¬äºŒæ­¥ï¼Œåœ¨Rich Functionçš„openæ–¹æ³•ä¸­æ³¨å†Œç´¯åŠ å™¨ï¼›<br />ç¬¬ä¸‰æ­¥ï¼Œä½¿ç”¨ç´¯åŠ å™¨ï¼›<br />ç¬¬å››æ­¥ï¼Œä½¿ç”¨JobExecutionResultå¯¹è±¡æŸ¥çœ‹ç´¯åŠ å™¨ç»“æœï¼Œä»£ç å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ©ç”¨ç´¯åŠ å™¨æ¥ç»Ÿè®¡å¤šå°‘ä¸ç¬¦åˆæ ‡å‡†çš„æ•°æ®</span></span><br><span class="line">env.readTextFile(<span class="string">"input/access.txt"</span>)</span><br><span class="line">      .map(<span class="keyword">new</span> <span class="type">RichMapFunction</span>[<span class="type">String</span>, <span class="type">Access</span>] &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºç´¯åŠ å™¨</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">val</span> total = <span class="keyword">new</span> <span class="type">IntCounter</span>()</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">val</span> wrong = <span class="keyword">new</span> <span class="type">IntCounter</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">open</span></span>(parameters: <span class="type">Configuration</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">          <span class="comment">//æ³¨å†Œç´¯åŠ å™¨</span></span><br><span class="line">          getRuntimeContext.addAccumulator(<span class="string">"num_total"</span>, total)</span><br><span class="line">          getRuntimeContext.addAccumulator(<span class="string">"num_wrong"</span>, wrong)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">close</span></span>(): <span class="type">Unit</span> = <span class="keyword">super</span>.close()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">map</span></span>(input: <span class="type">String</span>): <span class="type">Access</span> = &#123;</span><br><span class="line">          <span class="comment">//ä½¿ç”¨ç´¯åŠ å™¨</span></span><br><span class="line">          total.add(<span class="number">1</span>)</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">val</span> splits = input.split(<span class="string">","</span>)</span><br><span class="line">            <span class="type">Access</span>(splits(<span class="number">0</span>), splits(<span class="number">1</span>), splits(<span class="number">2</span>).toInt)</span><br><span class="line">          &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="keyword">case</span> e: <span class="type">Exception</span> =&gt; &#123;</span><br><span class="line">              wrong.add(<span class="number">1</span>)</span><br><span class="line">              <span class="literal">null</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//æŸ¥çœ‹ç»“æœ</span></span><br><span class="line"><span class="keyword">val</span> myJobExecutionResult = env.execute(<span class="keyword">this</span>.getClass.getSimpleName)</span><br><span class="line"><span class="keyword">val</span> resultTotal = myJobExecutionResult.getAccumulatorResult[<span class="type">Int</span>](<span class="string">"num_total"</span>)</span><br><span class="line"><span class="keyword">val</span> resultWrong = myJobExecutionResult.getAccumulatorResult[<span class="type">Int</span>](<span class="string">"num_wrong"</span>)</span><br><span class="line">println(<span class="string">"total num is "</span> + resultTotal + <span class="string">",wrong num is "</span> + resultWrong)</span><br></pre></td></tr></table></figure>

<p><strong>ä¸Šæ–‡æ‰€æ¶‰åŠåˆ°çš„ç¤ºä¾‹ä»£ç ä»¥åŠæ•°æ®çš†å·²ä¸Šä¼ åˆ°Githubä¸Šï¼Œå¦‚æœ‰éœ€è¦è¯·ç›´æ¥cloneåˆ°æœ¬åœ°ç›´æ¥è¿è¡Œï¼ŒğŸ”—é“¾æ¥å¦‚ä¸‹ï¼š</strong><br />[<a href="https://github.com/liverrrr/bigdata/tree/master/flink" target="_blank" rel="noopener">https://github.com/liverrrr/bigdata/tree/master/flink</a>)<br />ä¸Šæ–‡å¦‚æœ‰é”™è¯¯æˆ–æ˜¯çº°æ¼ï¼ŒğŸ‘æ¬¢è¿å„ä½ä¸‹æ–¹è¯„è®ºæŒ‡å‡ºï¼Œå¤§å®¶ä¸€èµ·äº¤æµå­¦ä¹ ğŸ“–</p>

                                                                        
                                    </div>
                                    <footer class="article-footer">
                                        <a data-url="http://yoursite.com/2020/02/05/Flink%E5%AE%9E%E6%88%98%E7%B3%BB%E5%88%97%EF%BC%88%E4%BA%8C%EF%BC%89%E4%B9%8B%E5%9F%BA%E7%A1%80API%E4%BD%BF%E7%94%A8/" data-id="ckbhdws0f0006ycudgl83d42r" class="article-share-link">
                                            åˆ†äº«
                                        </a>
                                        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Flink/" rel="tag">Flink</a></li></ul>

                                    </footer>

    </div>

    
        
  <nav class="article-nav">
    
      <a href="/2020/02/21/Flink%E5%AE%9E%E6%88%98%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%89%EF%BC%89%E4%B9%8BSource%E5%92%8CSink%E7%9A%84%E4%BD%BF%E7%94%A8/" class="article-nav-link">
        <strong class="article-nav-caption">å‰ä¸€ç¯‡</strong>
        <div class="article-nav-title">
          
            Flinkå®æˆ˜ç³»åˆ—ï¼ˆä¸‰ï¼‰ä¹‹Sourceå’ŒSinkçš„ä½¿ç”¨
          
        </div>
      </a>
    
    
      <a href="/2020/01/30/Flink%E5%AE%9E%E6%88%98%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%80%EF%BC%89%E4%B9%8B%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%E4%BB%A5%E5%8F%8A%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/" class="article-nav-link">
        <strong class="article-nav-caption">åä¸€ç¯‡</strong>
        <div class="article-nav-title">Flinkå®æˆ˜ç³»åˆ—ï¼ˆä¸€ï¼‰ä¹‹åŸºç¡€æ¦‚å¿µä»¥åŠç¯å¢ƒå‡†å¤‡</div>
      </a>
    
  </nav>


            

                
                    
                        
  <div class="gitalk" id="gitalk-container"></div>
  
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">

  
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

  
<script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>

  <script type="text/javascript">
    var gitalk = new Gitalk({
      clientID: 'b1d57bf081b044ac843f',
      clientSecret: 'ec3246ee68621c081334170e43f36dfefe9f535a',
      repo: 'gitTalk',
      owner: 'liverrrr',
      admin: ['liverrrr'],
      // id: location.pathname,      // Ensure uniqueness and length less than 50
      id: md5(location.pathname),
      distractionFreeMode: false,  // Facebook-like distraction free mode
      pagerDirection: 'last'
    })

  gitalk.render('gitalk-container')
  </script>

                            

</article>
</section>
  <footer class="footer">
  <div class="outer">
    <div class="float-right">
      <ul class="list-inline">
  
    <li><i class="fe fe-smile-alt"></i> <span id="busuanzi_value_site_uv"></span></li>
  
    <li><i class="fe fe-bookmark"></i> <span id="busuanzi_value_page_pv"></span></li>
  
</ul>
    </div>
    <ul class="list-inline">
      <li>&copy; 2020 è¶£éšè®°</li>
      <li>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></li>
      <li>Theme  <a href="https://github.com/zhwangart/hexo-theme-ocean" target="_blank" rel="noopener">Ocean</a></li>
    </ul>
  </div>
</footer>

</main>
<aside class="sidebar">
  <button class="navbar-toggle"></button>
<nav class="navbar">
  
    <div class="logo">
      <a href="/"><img src="/images/hexo.svg" alt="è¶£éšè®°"></a>
    </div>
  
  <ul class="nav nav-main">
    
      <li class="nav-item">
        <a class="nav-item-link" href="/">ä¸»é¡µ</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/archives">å½’æ¡£</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/gallery">ç›¸å†Œ</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/about">å…³äº</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/categories">ç±»åˆ«</a>
      </li>
    
    <li class="nav-item">
      <a class="nav-item-link nav-item-search" title="æœç´¢">
        <i class="fe fe-search"></i>
        æœç´¢
      </a>
    </li>
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      <div class="totop" id="totop">
  <i class="fe fe-rocket"></i>
</div>
    </li>
    <li class="nav-item">
      
        <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
          <i class="fe fe-feed"></i>
        </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
</aside>

<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/jquery.justifiedGallery.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script src="/js/busuanzi-2.3.pure.min.js"></script>


  
<script src="/fancybox/jquery.fancybox.min.js"></script>




  
<script src="/js/tocbot.min.js"></script>

  <script>
    // Tocbot_v4.7.0  http://tscanlin.github.io/tocbot/
    tocbot.init({
      tocSelector: '.tocbot',
      contentSelector: '.article-entry',
      headingSelector: 'h1, h2, h3, h4, h5, h6',
      hasInnerContainers: true,
      scrollSmooth: true,
      positionFixedSelector: '.tocbot',
      positionFixedClass: 'is-position-fixed',
      fixedSidebarOffset: 'auto',
    });
  </script>



<script src="/js/ocean.js"></script>


</body>
</html>